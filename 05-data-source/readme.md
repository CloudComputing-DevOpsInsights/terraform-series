# Terraform Data Sources Examples

This repository contains examples of using Terraform data sources to fetch information from AWS and utilize it within your infrastructure deployment.

## 1. Fetch the Most Recent Ubuntu 20.04 AMI ID
This example shows how to retrieve the most recent Ubuntu 20.04 AMI ID. The data source fetches AMI details by filtering the AMI name pattern for `ubuntu-*-20.04-amd64-server-*`. This ensures you always get the latest Ubuntu 20.04 AMI for your EC2 instances.

### How to Use:
- Clone the repository and initialize the Terraform provider.
- Run the `terraform init` command to download any necessary Terraform modules.
- Use `terraform plan` and `terraform apply` to get the Ubuntu AMI ID.

### Explanation:
- The `aws_ami` data source pulls the most recent image with the filter condition that checks for the desired Ubuntu version.
- The AMI ID will then be output for use in EC2 instance provisioning or other infrastructure components.

## 2. Launch an EC2 Instance Using the Fetched Ubuntu AMI
Once you retrieve the Ubuntu 20.04 AMI ID, this example shows how to launch a new EC2 instance of type `t2.micro` using the fetched AMI ID.

### How to Use:
- Ensure the AMI ID output from the previous step is available.
- In your EC2 configuration, use the AMI ID in the `ami` parameter to launch an EC2 instance.

### Explanation:
- This example provisions a `t2.micro` EC2 instance based on the Ubuntu 20.04 AMI fetched in the previous step.
- The root volume of the EC2 instance is set to delete on termination, ensuring clean removal of the instance.

## 3. Retrieve AWS Account Details
This section shows how to retrieve basic AWS account details such as the account ID and ARN using the `aws_caller_identity` data source.

### How to Use:
- Run `terraform plan` and `terraform apply` to fetch your AWS account details.

### Explanation:
- The `aws_caller_identity` data source allows you to access details about the AWS account, such as the account ID and ARN.
- Useful for logging or tagging infrastructure with account-specific details.

## 4. Retrieve VPC Information Tagged with `env = prod`
This section demonstrates how to fetch a VPC tagged with `env = prod`, allowing you to identify and reference specific VPCs for your infrastructure configuration.

### How to Use:
- Use this to fetch VPC details in your project associated with a "production" environment tag.

### Explanation:
- The `aws_vpc` data source allows fetching the VPC's details based on tags like `env = prod`, which can be helpful for managing multiple environments (e.g., prod, dev, staging).

## 5. Retrieve AWS Availability Zones
This section retrieves all available AWS availability zones in your region, enabling you to provision infrastructure across multiple zones for high availability.

### How to Use:
- Run `terraform plan` and `terraform apply` to retrieve availability zone names for your region.

### Explanation:
- The `aws_availability_zones` data source provides the availability zone names, which can be used in creating resources across multiple zones for fault tolerance.

## 6. Create an S3 Bucket
This section shows how to create an S3 bucket using the `aws_s3_bucket` resource in Terraform.

### How to Use:
- Run `terraform apply` to create the S3 bucket in your AWS account.

### Explanation:
- This example creates a new S3 bucket with a fixed name for use in storing data such as backups, application logs, or static assets.

## 7. Define an S3 Bucket Policy Allowing Read Access (`s3:GetObject`)
The example defines a bucket policy for your S3 bucket to allow read access (`s3:GetObject`). This policy can be useful for providing public access to content in the bucket, such as shared static files.

### How to Use:
- Use the policy JSON generated by Terraform to attach to your S3 bucket for controlling access permissions.

### Explanation:
- The `aws_iam_policy_document` data source generates a bucket policy that allows public read access to the specified S3 bucket.
- The policy is output in JSON format for easy integration into your S3 bucket configuration.

## Instructions for Running the Examples
1. Clone this repository to your local machine.
2. Run `terraform init` to initialize the working directory and download necessary dependencies.
3. Apply the Terraform files with `terraform plan` to check for changes and `terraform apply` to deploy the infrastructure.
4. View the outputs (such as AMI ID, AWS account details, availability zone names, etc.) after applying the configuration.

---

This repository serves as a reference for utilizing Terraform data sources efficiently to automate AWS infrastructure management.

